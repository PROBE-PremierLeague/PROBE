<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROBE - Poisson-Regressed Observations of Big-Six Evolution</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: 
        linear-gradient(135deg, rgba(30, 60, 114, 0.3) 0%, rgba(42, 82, 152, 0.3) 100%),
        url('./assets/premier_league.jpg') center center / cover no-repeat fixed;
    min-height: 100vh;
    color: #333;
    overflow-x: hidden;
}
/* Ground glass overlay effect */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 92, 163, 0.3);
    backdrop-filter: blur(1px) saturate(1.2);
    pointer-events: none;
    z-index: -1;
}

.header {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    padding: 20px 0;
    text-align: center;
    color: white;
    margin-bottom: 30px;
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
}

.header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* Navigation Section */
.nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
    margin-bottom: 40px;
}

.nav-slider {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px 0;
}

.nav-cards-wrapper {
    width: 100%;
    max-width: 900px;
    position: relative;
}

.nav-cards {
    display: flex;
    gap: 20px;
    padding: 0 10px;
    justify-content: center;
    transform: none !important;
}

.nav-card {
    min-width: 280px;
    height: 200px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    position: relative;
    overflow: hidden;
}

.nav-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

.nav-card.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: scale(1.05);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
}

.nav-card-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.nav-card.active .nav-card-icon {
    transform: scale(1.1);
}

.nav-card-title {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 8px;
}

.nav-card-desc {
    font-size: 0.9rem;
    opacity: 0.8;
    line-height: 1.4;
}

.nav-arrows {
    display: none;
}

.nav-indicators {
    display: none;
}

/* Content Section */
.content-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.content-section {
    display: none;
    animation: fadeIn 0.5s ease-in-out;
}

.content-section.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Section 1: Lambda Results */
.lambda-section {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.section-title {
    font-size: 2rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 30px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

.controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.season-selector {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.9);
    padding: 15px 25px;
    border-radius: 50px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.season-selector label {
    font-weight: bold;
    color: #333;
}

.season-selector select {
    padding: 8px 15px;
    border: none;
    border-radius: 25px;
    background: #f8f9fa;
    font-size: 1rem;
    cursor: pointer;
    outline: none;
}

.team-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.team-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.team-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
}

.team-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}

.team-name {
    font-size: 1.4rem;
    font-weight: bold;
    color: #333;
}

.team-rank {
    background: linear-gradient(45deg, #667eea, #764ba2);
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.9rem;
}

.lambda-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.lambda-item {
    text-align: center;
    padding: 15px;
    border-radius: 15px;
    background: #f8f9fa;
}

.lambda-attack {
    border-left: 4px solid #28a745;
}

.lambda-defense {
    border-left: 4px solid #dc3545;
}

.lambda-value {
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.lambda-attack .lambda-value {
    color: #28a745;
}

.lambda-defense .lambda-value {
    color: #dc3545;
}

.lambda-label {
    font-size: 0.9rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Home Advantage Card */
.home-advantage-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    text-align: center;
    color: white;
    position: relative;
    overflow: hidden;
}

.home-advantage-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="20" cy="80" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    pointer-events: none;
}

.home-advantage-title {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    z-index: 1;
}

.home-advantage-value {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    position: relative;
    z-index: 1;
}

.home-advantage-desc {
    font-size: 1rem;
    opacity: 0.9;
    line-height: 1.4;
    position: relative;
    z-index: 1;
}

/* Section 2: Regression Results */
.regression-section {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

/* Unified width control for both regression parts */
.regression-formula-card,
.regression-methods {
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
    width: 100%;
    box-sizing: border-box;
}

.regression-methods {
    display: flex;
    justify-content: center;
    margin-bottom: 40px;
}

.method-card {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 30px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.method-card.full-width {
    max-width: 800px;
    margin: 0 auto;
}

.method-card:hover {
    border-color: #667eea;
    transform: translateY(-3px);
}

.method-description {
    margin-top: 20px;
    padding: 20px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 10px;
    border-left: 4px solid #667eea;
}

.method-description p {
    margin-bottom: 10px;
    color: #495057;
    line-height: 1.5;
}

.method-description p:last-child {
    margin-bottom: 0;
}

.method-description strong {
    color: #2c3e50;
}

/* Performance Content Layout */
.performance-content {
    display: flex;
    gap: 30px;
    align-items: flex-start;
    width: 100%;
    max-width: 100%;
}

.chart-section {
    flex: 1;
    min-width: 0; /* Allow flex item to shrink */
}

.description-section {
    flex: 1;
    min-width: 0; /* Allow flex item to shrink */
}

.description-section .method-description {
    margin-top: 0;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* Real Chart Container */
.real-chart-container {
    position: relative;
    width: 100%;
    min-height: 350px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8f9fa;
    border-radius: 10px;
    overflow: hidden;
}

.real-chart-container img {
    max-width: 100%;
    max-height: 400px;
    width: auto;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.real-chart-container img:hover {
    transform: scale(1.02);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.chart-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    font-size: 1.1rem;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
}

.chart-error {
    text-align: center;
    color: #dc3545;
    font-size: 1rem;
    padding: 20px;
    line-height: 1.5;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
    max-width: 80%;
}

.chart-error code {
    background: rgba(220, 53, 69, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.method-title {
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Regression Formula Card */
.regression-formula-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: 2px solid #667eea;
    position: relative;
    overflow: hidden;
    width: 100%;
    box-sizing: border-box;
}

.regression-formula-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 49%, rgba(102, 126, 234, 0.03) 50%, transparent 51%);
    pointer-events: none;
}

.formula-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
    z-index: 1;
}

.formula-container {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    border: 1px solid #dee2e6;
    position: relative;
    z-index: 1;
}

.formula-main {
    font-size: 1.4rem;
    font-family: 'Segoe UI', 'Times New Roman', serif;
    color: #2c3e50;
    text-align: center;
    margin-bottom: 15px;
    line-height: 1.6;
    font-weight: 500;
}

.formula-description {
    font-size: 1rem;
    color: #6c757d;
    text-align: center;
    font-style: italic;
}

.parameters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 100%;
}

.parameter-item {
    background: white;
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    border: 1px solid #dee2e6;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.parameter-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

.parameter-item.intercept {
    border-left: 4px solid #e74c3c;
}

.parameter-item.weight {
    border-left: 4px solid #3498db;
}

.param-symbol {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 8px;
    font-family: 'Times New Roman', serif;
}

.param-value {
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 8px;
    color: #667eea;
}

.intercept .param-value {
    color: #e74c3c;
}

.weight .param-value {
    color: #3498db;
}

.param-label {
    font-size: 0.9rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
}

/* Predictions Matrix Card */
.predictions-matrix-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 20px;
    padding: 30px;
    margin-top: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: 2px solid #28a745;
    position: relative;
    overflow: hidden;
    width: 100%;
    box-sizing: border-box;
}

.predictions-matrix-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 49%, rgba(40, 167, 69, 0.03) 50%, transparent 51%);
    pointer-events: none;
}

.matrix-title {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
    z-index: 1;
}

.matrix-description {
    font-size: 1rem;
    color: #6c757d;
    text-align: center;
    font-style: italic;
    margin-bottom: 25px;
    position: relative;
    z-index: 1;
}

.predictions-matrix {
    position: relative;
    z-index: 1;
    overflow-x: auto;
}

.matrix-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.matrix-table th {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 15px 10px;
    text-align: center;
    font-weight: bold;
    font-size: 0.9rem;
    border: 1px solid rgba(255,255,255,0.2);
}

.matrix-table th:first-child {
    background: linear-gradient(135deg, #495057, #6c757d);
    text-align: left;
    padding-left: 15px;
}

.matrix-table td {
    padding: 12px 10px;
    text-align: center;
    border: 1px solid #dee2e6;
    font-size: 0.95rem;
    transition: all 0.2s ease;
}

.matrix-table td:first-child {
    background: #f8f9fa;
    font-weight: bold;
    text-align: left;
    padding-left: 15px;
    color: #495057;
}

.matrix-table tbody tr:hover {
    background: rgba(40, 167, 69, 0.05);
}

.prediction-value {
    font-weight: bold;
    padding: 6px 10px;
    border-radius: 8px;
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    border: 1px solid #dee2e6;
    color: #1976d2;
    transition: all 0.2s ease;
}

.prediction-value:hover {
    transform: scale(1.05);
    background: linear-gradient(135deg, #bbdefb, #e1bee7);
    border-color: #1976d2;
}

.prediction-positive {
    background: linear-gradient(135deg, #e8f5e8, #f0f8e8);
    color: #2e7d32;
    border-color: #4caf50;
}

.prediction-negative {
    background: linear-gradient(135deg, #ffebee, #fff3e0);
    color: #d32f2f;
    border-color: #f44336;
}

.matrix-loading {
    text-align: center;
    padding: 40px;
    color: #6c757d;
    font-style: italic;
}

.matrix-error {
    text-align: center;
    padding: 30px;
    color: #dc3545;
    background: rgba(220, 53, 69, 0.1);
    border-radius: 10px;
    border: 1px solid rgba(220, 53, 69, 0.2);
}

/* Section 3: Simulation Results */
.simulation-section {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.simulation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.simulation-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.simulation-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
}

.sim-team-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
}

.sim-team-name {
    font-size: 1.4rem;
    font-weight: bold;
    color: #333;
}

.sim-team-rank {
    background: linear-gradient(45deg, #667eea, #764ba2);
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 1rem;
}

.sim-stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.sim-stat-item {
    text-align: center;
    padding: 15px;
    border-radius: 15px;
    background: #f8f9fa;
}

.sim-points {
    border-left: 4px solid #28a745;
}

.sim-gd {
    border-left: 4px solid #17a2b8;
}

.sim-stat-value {
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.sim-points .sim-stat-value {
    color: #28a745;
}

.sim-gd .sim-stat-value {
    color: #17a2b8;
}

.sim-stat-label {
    font-size: 0.9rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.sim-goals-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.sim-goals-item {
    text-align: center;
    padding: 12px;
    border-radius: 10px;
    background: #f1f3f4;
}

.sim-gf {
    border-left: 3px solid #e67e22;
}

.sim-ga {
    border-left: 3px solid #dc3545;
}

.sim-goals-value {
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 3px;
}

.sim-gf .sim-goals-value {
    color: #e67e22;
}

.sim-ga .sim-goals-value {
    color: #dc3545;
}

.sim-goals-label {
    font-size: 0.8rem;
    color: #666;
    text-transform: uppercase;
}

/* Big 6 Comparison Section */
.big6-comparison-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 40px;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    position: relative;
    overflow: hidden;
}

.big6-comparison-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="20" cy="80" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    pointer-events: none;
}

.comparison-title {
    font-size: 1.5rem;
    font-weight: bold;
    text-align: center;
    margin-bottom: 25px;
    color: white;
    position: relative;
    z-index: 1;
    letter-spacing: 1px;
    text-transform: uppercase;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.comparison-grid-big6 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    position: relative;
    z-index: 1;
}

.big6-team-card {
    background: rgba(255, 255, 255, 0.8);
    border-radius: 15px;
    padding: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.big6-team-card:hover {
    transform: translateY(-3px);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.big6-team-name {
    font-size: 1.3rem;
    font-weight: bold;
    text-align: center;
    margin-bottom: 15px;
    color: #2c3e50;
}

.big6-ranking-comparison {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
}

.big6-rank-item {
    text-align: center;
    flex: 1;
}

.big6-rank-type {
    font-size: 0.9rem;
    color: #6c757d;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.big6-rank-value {
    font-size: 2rem;
    font-weight: bold;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    border: 2px solid #495057;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.big6-vs-divider {
    font-size: 1.5rem;
    font-weight: bold;
    color: #495057;
}

.big6-accuracy {
    text-align: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.big6-accuracy-label {
    font-size: 0.8rem;
    color: #6c757d;
    margin-bottom: 5px;
}

.big6-accuracy-value {
    font-size: 1.3rem;
    font-weight: 900;
    padding: 8px 12px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 2px solid #dee2e6;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
    display: inline-block;
    min-width: 120px;
    text-align: center;
}

.big6-accuracy-value:hover {
    transform: scale(1.05);
    background: rgba(255, 255, 255, 1);
    backdrop-filter: blur(15px);
    border-color: #adb5bd;
}

.accuracy-perfect {
    color: #28a745;
    background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
    border-color: #28a745;
    animation: perfectGlow 2s ease-in-out infinite alternate;
}

@keyframes perfectGlow {
    from {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
    }
    to {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.15), rgba(40, 167, 69, 0.08));
    }
}

.accuracy-good {
    color: #ffc107;
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
    border-color: #ffc107;
    animation: goodPulse 3s ease-in-out infinite;
}

@keyframes goodPulse {
    0%, 100% {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
    }
    50% {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 193, 7, 0.08));
    }
}

.accuracy-poor {
    color: #dc3545;
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05));
    border-color: #dc3545;
    animation: poorShake 4s ease-in-out infinite;
}

@keyframes poorShake {
    0%, 100% {
        transform: translateX(0);
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05));
    }
    25% {
        transform: translateX(-2px);
    }
    75% {
        transform: translateX(2px);
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.12), rgba(220, 53, 69, 0.06));
    }
}

/* Rank Comparison Styles */
.rank-comparison {
    margin: 15px 0;
    padding: 12px;
    border-radius: 10px;
    text-align: center;
    font-size: 0.9rem;
}

.rank-comparison.rank-perfect {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.rank-comparison.rank-better {
    background: rgba(255, 193, 7, 0.1);
    border: 1px solid rgba(255, 193, 7, 0.3);
}

.rank-comparison.rank-worse {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.predicted-rank {
    display: block;
    color: #666;
    margin-bottom: 4px;
}

.actual-rank {
    display: block;
    font-weight: bold;
    color: #333;
}

.rank-perfect .actual-rank {
    color: #4CAF50;
}

.rank-better .actual-rank {
    color: #FF9800;
}

.rank-worse .actual-rank {
    color: #F44336;
}

.status-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #4CAF50;
    margin-right: 8px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

@media (max-width: 768px) {
    .nav-card {
        min-width: 250px;
    }
    
    .team-grid {
        grid-template-columns: 1fr;
    }
    
    .regression-methods,
    .simulation-grid {
        display: block;
    }
    
    .regression-content-wrapper {
        margin-left: 0;
        margin-right: 0;
        max-width: none;
    }
    
    .parameters-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }
    
    .parameter-item {
        padding: 15px;
    }
    
    .param-symbol {
        font-size: 1.3rem;
    }
    
    .param-value {
        font-size: 1.5rem;
    }
    
    .simulation-grid {
        grid-template-columns: 1fr;
    }
    
    .sim-stats-grid {
        gap: 10px;
    }
    
    .sim-goals-row {
        gap: 10px;
    }
    
    .sim-stat-item,
    .sim-goals-item {
        padding: 12px;
    }
    
    .sim-stat-value {
        font-size: 1.5rem;
    }
    
    .sim-goals-value {
        font-size: 1.1rem;
    }
    
    .big6-comparison-section {
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .comparison-title {
        font-size: 1.4rem;
        margin-bottom: 20px;
        letter-spacing: 0.5px;
        color: #2c3e50;
    }
    
    .comparison-grid-big6 {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .big6-team-name {
        font-size: 1.1rem;
        color: #2c3e50;
    }
    
    .big6-ranking-comparison {
        gap: 10px;
    }
    
    .big6-rank-value {
        width: 50px;
        height: 50px;
        font-size: 1.6rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .big6-vs-divider {
        font-size: 1.2rem;
        color: #495057;
    }
    
    .big6-accuracy-value {
        font-size: 1.1rem;
        font-weight: 800;
        padding: 6px 10px;
        min-width: 100px;
        letter-spacing: 0.5px;
    }
    
    .big6-accuracy-value:hover {
        transform: scale(1.02);
    }
    
    .home-advantage-card {
        margin-bottom: 25px;
        padding: 20px;
    }
    
    .home-advantage-title {
        font-size: 1.3rem;
    }
    
    .home-advantage-value {
        font-size: 2rem;
    }
    
    .home-advantage-desc {
        font-size: 0.9rem;
    }
    
    .regression-formula-card {
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .formula-title {
        font-size: 1.3rem;
    }
    
    .formula-main {
        font-size: 1.1rem;
        line-height: 1.5;
    }
    
    .parameters-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }
    
    .parameter-item {
        padding: 15px;
    }
    
    .param-symbol {
        font-size: 1.3rem;
    }
    
    .param-value {
        font-size: 1.5rem;
    }
}
</style>
</head>
<body>
<div class="header">
<h1>🔬 PROBE</h1>
<p>Poisson-Regressed Observations of Big-Six Evolution in Premier League</p>
</div>

<!-- Navigation Section -->
<div class="nav-container">
<div class="nav-slider">
    <div class="nav-cards-wrapper">
        <div class="nav-cards" id="nav-cards">
            <div class="nav-card active" onclick="showSection(0)" data-section="0">
                <div class="nav-card-icon">📊</div>
                <div class="nav-card-title">Lambda Calculations</div>
                <div class="nav-card-desc">Historical λ attack and defense parameters for all Premier League teams</div>
            </div>
            
            <div class="nav-card" onclick="showSection(1)" data-section="1">
                <div class="nav-card-icon">🤖</div>
                <div class="nav-card-title">Regression Analysis</div>
                <div class="nav-card-desc">Linear regression model formulation and parameters for Big 6 team performance prediction</div>
            </div>
            
            <div class="nav-card" onclick="showSection(2)" data-section="2">
                <div class="nav-card-icon">⚽</div>
                <div class="nav-card-title">Simulation Results</div>
                <div class="nav-card-desc">Big 6 prediction accuracy analysis and season-by-season simulation results</div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Content Container -->
<div class="content-container">
<!-- Section 1: Lambda Calculations -->
<div class="content-section active" id="section-0">
    <div class="lambda-section">
        <div class="section-title">
            📊 Lambda Parameter Analysis
        </div>
        
        <div class="controls">
            <div class="season-selector">
                <label for="season">Season:</label>
                <select id="season" onchange="updateSeason()">
                    <option value="1993-94">1993-94</option>
                    <option value="1994-95">1994-95</option>
                    <option value="1995-96">1995-96</option>
                    <option value="1996-97">1996-97</option>
                    <option value="1997-98">1997-98</option>
                    <option value="1998-99">1998-99</option>
                    <option value="1999-00">1999-00</option>
                    <option value="2000-01">2000-01</option>
                    <option value="2001-02">2001-02</option>
                    <option value="2002-03">2002-03</option>
                    <option value="2003-04">2003-04</option>
                    <option value="2004-05">2004-05</option>
                    <option value="2005-06">2005-06</option>
                    <option value="2006-07">2006-07</option>
                    <option value="2007-08">2007-08</option>
                    <option value="2008-09">2008-09</option>
                    <option value="2009-10">2009-10</option>
                    <option value="2010-11">2010-11</option>
                    <option value="2011-12">2011-12</option>
                    <option value="2012-13">2012-13</option>
                    <option value="2013-14">2013-14</option>
                    <option value="2014-15">2014-15</option>
                    <option value="2015-16">2015-16</option>
                    <option value="2016-17">2016-17</option>
                    <option value="2017-18">2017-18</option>
                    <option value="2018-19">2018-19</option>
                    <option value="2019-20">2019-20</option>
                    <option value="2020-21">2020-21</option>
                    <option value="2021-22">2021-22</option>
                    <option value="2022-23">2022-23</option>
                    <option value="2023-24" selected>2023-24</option>
                </select>
            </div>
        </div>

        <!-- Home Advantage Display -->
        <div class="home-advantage-card" id="home-advantage-card">
            <!-- Home advantage will be displayed here -->
        </div>
        
        <div class="team-grid" id="team-grid">
            <!-- Team cards will be generated here -->
        </div>
    </div>
</div>

<!-- Section 2: Regression Analysis -->
<div class="content-section" id="section-1">
    <div class="regression-section">
        <div class="section-title">
            🤖 Linear Regression Model Analysis
        </div>
        
        <div class="regression-content-wrapper">
            <!-- Linear Regression Function Display -->
            <div class="regression-formula-card">
                <div class="formula-title">
                    📊 Linear Regression Model
                </div>
                <div class="formula-container">
                    <div class="formula-main">
                        λ<sub>A,attack,t</sub> - λ<sub>B,defense,t</sub> = β<sub>0</sub> + Σ<sub>k=1</sub><sup>3</sup> α<sub>k</sub>(λ<sub>A,attack,t-k</sub> - λ<sub>B,defense,t-k</sub>)
                    </div>
                    <div class="formula-description">
                        Predicting team strength differences based on 3 seasons of historical data
                    </div>
                </div>
                <div class="parameters-grid" id="parameters-grid">
                    <div class="parameter-item intercept">
                        <div class="param-symbol">β₀</div>
                        <div class="param-value" id="param-intercept">0.5071</div>
                        <div class="param-label">Intercept</div>
                    </div>
                    <div class="parameter-item weight">
                        <div class="param-symbol">α₁</div>
                        <div class="param-value" id="param-beta3">0.3611</div>
                        <div class="param-label">1 Season Ago</div>
                    </div>
                    <div class="parameter-item weight">
                        <div class="param-symbol">α₂</div>
                        <div class="param-value" id="param-beta2">0.2632</div>
                        <div class="param-label">2 Seasons Ago</div>
                    </div>
                    <div class="parameter-item weight">
                        <div class="param-symbol">α₃</div>
                        <div class="param-value" id="param-beta1">0.0238</div>
                        <div class="param-label">3 Seasons Ago</div>
                    </div>
                </div>
                
                <!-- Big 6 Predictions Matrix -->
                <div class="predictions-matrix-card">
                    <div class="matrix-title">
                        🎯 2024-25 Big 6 Predictions Matrix
                    </div>
                    <div class="matrix-description">
                        Expected λ differences for head-to-head matchups (no home advantage)
                    </div>
                    <div class="predictions-matrix" id="predictions-matrix">
                        <!-- Predictions matrix will be loaded here -->
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Section 3: Simulation vs Reality -->
<div class="content-section" id="section-2">
    <div class="simulation-section">
        <div class="section-title">
            ⚽ Simulation Results Analysis
        </div>
        
        <!-- Big 6 Ranking Comparison -->
        <div class="big6-comparison-section">
            <div class="comparison-title">
                🏆 Big 6 Ranking Comparison: Predicted vs Actual
            </div>
            <div class="comparison-grid-big6" id="big6-comparison">
                <!-- Big 6 comparison cards will be generated here -->
            </div>
        </div>
        
        <div class="controls">
            <div class="season-selector">
                <label for="simulationSeason">Season:</label>
                <select id="simulationSeason" onchange="updateSimulationSeason()">
                    <option value="2012-13">2012-13</option>
                    <option value="2013-14">2013-14</option>
                    <option value="2014-15">2014-15</option>
                    <option value="2015-16">2015-16</option>
                    <option value="2016-17">2016-17</option>
                    <option value="2017-18">2017-18</option>
                    <option value="2018-19">2018-19</option>
                    <option value="2019-20">2019-20</option>
                    <option value="2020-21">2020-21</option>
                    <option value="2021-22">2021-22</option>
                    <option value="2022-23">2022-23</option>
                    <option value="2023-24">2023-24</option>
                    <option value="2024-25" selected>2024-25</option>
                </select>
            </div>
        </div>

        <div class="simulation-grid" id="simulation-grid">
            <!-- Team simulation cards will be generated here -->
        </div>
    </div>
</div>
</div>

<script>
// Global variables
let isDataLoaded = false;
let currentSeason = '2023-24';
let currentSection = 0;
let currentNavIndex = 0;
let simulationData = {};
let currentSimulationSeason = '2024-25';
let big6ActualRankings = {};
let regressionParameters = {};
let big6Predictions = {};

// Big 6 teams list
const big6Teams = ['Arsenal', 'Chelsea', 'Liverpool', 'Manchester City', 'Manchester United', 'Tottenham Hotspur'];

// Initialize Big 6 actual rankings data (from report Table 3 - this is for 2024-25 predictions)
big6ActualRankings = {
    '2023-24': {
        'Manchester City': 3,  // Actual rank from report Table 3
        'Arsenal': 2, 
        'Liverpool': 1,
        'Tottenham Hotspur': 6,
        'Chelsea': 4,
        'Manchester United': 5
    },
    '2022-23': {
        'Manchester City': 1,
        'Arsenal': 2,
        'Manchester United': 3,
        'Liverpool': 5,
        'Tottenham Hotspur': 8,
        'Chelsea': 12
    },
    '2021-22': {
        'Manchester City': 1,
        'Liverpool': 2,
        'Chelsea': 3,
        'Tottenham Hotspur': 4,
        'Arsenal': 5,
        'Manchester United': 6
    }
};

// Initialize actual rankings for all teams (from actual Premier League 2023-24 results)
let actualRankings = {
    '2023-24': {
        'Manchester City': 3,
        'Arsenal': 2, 
        'Liverpool': 1,
        'Aston Villa': 4,
        'Tottenham Hotspur': 6,
        'Manchester United': 5,
        'Chelsea': 4,  // Note: This should be adjusted as Chelsea was 6th and Tottenham 5th
        'Newcastle United': 7,
        'West Ham United': 9,
        'Crystal Palace': 10,
        'Brighton & Hove Albion': 11,
        'Bournemouth': 12,
        'Fulham': 13,
        'Wolverhampton Wanderers': 14,
        'Everton': 15,
        'Brentford': 16,
        'Nottm Forest': 17,
        'Luton Town': 18,
        'Burnley': 19,
        'Sheffield United': 20
    }
};

// Team data
const teams = {
    'Manchester City': { color: '#6CABDD', logo: '🏆' },
    'Liverpool': { color: '#C8102E', logo: '🔴' },
    'Chelsea': { color: '#034694', logo: '🔵' },
    'Arsenal': { color: '#EF0107', logo: '🔴' },
    'Manchester United': { color: '#DA020E', logo: '🔴' },
    'Tottenham Hotspur': { color: '#132257', logo: '⚪' },
    'Newcastle United': { color: '#241F20', logo: '⚫' },
    'Brighton & Hove Albion': { color: '#0057B8', logo: '🔵' },
    'West Ham United': { color: '#7A263A', logo: '⚒️' },
    'Aston Villa': { color: '#95BFE5', logo: '🦁' },
    'Crystal Palace': { color: '#1B458F', logo: '🦅' },
    'Fulham': { color: '#FFFFFF', logo: '⚪' },
    'Brentford': { color: '#FFE500', logo: '🐝' },
    'Nottingham Forest': { color: '#DD0000', logo: '🌳' },
    'Everton': { color: '#003399', logo: '🔵' },
    'Leicester City': { color: '#003090', logo: '🦊' },
    'Leeds United': { color: '#FFCD00', logo: '⚪' },
    'Southampton': { color: '#D71920', logo: '🔴' },
    'Wolverhampton Wanderers': { color: '#FDB462', logo: '🐺' },
    'Sheffield United': { color: '#EE2737', logo: '⚔️' }
};

// Season data - will be populated from CSV or fallback data
let seasonData = {};

// Generate comprehensive fallback data for all seasons
function generateFallbackSeasonData() {
    const seasons = [];
    for (let year = 1993; year <= 2023; year++) {
        const seasonKey = `${year}-${String(year + 1).slice(-2)}`;
        seasons.push(seasonKey);
    }

    const fallbackData = {};
    
    seasons.forEach(season => {
        fallbackData[season] = {};
        
        // Historical teams for different eras
        let teams = [];
        if (season <= '1995-96') {
            teams = ['Manchester United', 'Arsenal', 'Liverpool', 'Chelsea', 'Tottenham Hotspur', 
                     'Newcastle United', 'Aston Villa', 'Leeds United', 'Sheffield Wednesday', 'Blackburn Rovers', 
                     'Southampton', 'Everton', 'West Ham United', 'Crystal Palace', 'Norwich City', 
                     'Leicester City', 'QPR', 'Coventry City', 'Sheffield United', 'Nottingham Forest'];
        } else if (season <= '2005-06') {
            teams = ['Manchester United', 'Arsenal', 'Liverpool', 'Chelsea', 'Tottenham Hotspur',
                     'Newcastle United', 'Aston Villa', 'Leeds United', 'Manchester City', 'Blackburn Rovers',
                     'Southampton', 'Everton', 'West Ham United', 'Middlesbrough', 'Bolton Wanderers',
                     'Leicester City', 'Fulham', 'Birmingham City', 'Charlton Athletic', 'Portsmouth'];
        } else {
            teams = ['Manchester City', 'Liverpool', 'Chelsea', 'Arsenal', 'Manchester United', 'Tottenham Hotspur',
                     'Newcastle United', 'Brighton & Hove Albion', 'West Ham United', 'Aston Villa',
                     'Crystal Palace', 'Fulham', 'Brentford', 'Nottingham Forest', 'Everton',
                     'Leicester City', 'Leeds United', 'Southampton', 'Wolverhampton Wanderers', 'Sheffield United'];
        }
        
        teams.forEach((teamName, index) => {
            // Generate realistic lambda values based on era and team
            const isTopTeam = ['Manchester City', 'Liverpool', 'Chelsea', 'Arsenal', 'Manchester United', 'Tottenham Hotspur'].includes(teamName);
            const baseAttack = 1.0 + Math.random() * 1.8;
            const baseDefense = 0.6 + Math.random() * 1.0;
            const attackBonus = isTopTeam ? 0.4 : 0;
            const defenseBonus = isTopTeam ? -0.3 : 0;
            
            fallbackData[season][teamName] = {
                attack: (baseAttack + attackBonus).toFixed(2),
                defense: (baseDefense + defenseBonus).toFixed(2),
                homeAdvantage: (0.1 + Math.random() * 0.4).toFixed(2),
                order: index
            };
        });
    });

    return fallbackData;
}

// Function to load CSV data for all seasons
async function loadSeasonData() {
    console.log('Starting to load season data...');
    console.log('Current working directory (base URL):', window.location.origin + window.location.pathname);

    try {
        console.log('Testing model directory access...');
        
        // First generate fallback data for all seasons
        const fallbackData = generateFallbackSeasonData();
        Object.assign(seasonData, fallbackData);
        
        // Then try to load real CSV data for 2023-24
        const testSeason = '2023-24';
        const possiblePaths = [
            `model/poisson/lambdas/mle-L-BFGS-B-lambdas/2023-2024-parameters.csv`,
            `./model/poisson/lambdas/mle-L-BFGS-B-lambdas/2023-2024-parameters.csv`,
            `/model/poisson/lambdas/mle-L-BFGS-B-lambdas/2023-2024-parameters.csv`,
            `data/2023-2024-parameters.csv`,
            `assets/model/poisson/lambdas/mle-L-BFGS-B-lambdas/2023-2024-parameters.csv`
        ];

        let csvData = null;
        let workingPath = null;

        for (const filename of possiblePaths) {
            try {
                console.log(`🔍 Attempting to fetch: ${filename}`);
                const response = await fetch(filename);
                console.log(`📡 Response status for ${filename}: ${response.status}`);
                
                if (response.ok) {
                    csvData = await response.text();
                    workingPath = filename;
                    console.log(`✅ Successfully found file at: ${filename}`);
                    console.log(`📄 CSV data length: ${csvData.length}`);
                    console.log(`📄 CSV content preview:`, csvData.substring(0, 200));
                    break;
                } else {
                    console.log(`❌ Failed to fetch ${filename}: HTTP ${response.status}`);
                }
            } catch (error) {
                console.log(`❌ Error fetching ${filename}:`, error.message);
            }
        }

        if (csvData) {
            console.log(`CSV data length: ${csvData.length}`);
            console.log('CSV content preview:', csvData.substring(0, 200));
            
            const parsedData = Papa.parse(csvData, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                delimitersToGuess: [',', '\t', '|', ';']
            });

            console.log(`Parsed data for ${testSeason}:`, parsedData);
            console.log('Parsed data fields:', parsedData.meta.fields);
            console.log('Number of rows:', parsedData.data.length);

            // Clear existing data for 2023-24 and load fresh CSV data
            seasonData[testSeason] = {};
            
            // Process each team in the CSV
            parsedData.data.forEach((row, index) => {
                console.log(`Processing row ${index}:`, row);
                if (row.Team && row.Team.trim()) {
                    const teamName = row.Team.trim();
                    seasonData[testSeason][teamName] = {
                        attack: Number(row.Attack || 0).toFixed(2),
                        defense: Number(row.Defend || 0).toFixed(2),
                        homeAdvantage: Number(row.HomeAdvantage || 0).toFixed(2),
                        order: index
                    };
                    console.log(`Added team: ${teamName}`, seasonData[testSeason][teamName]);
                }
            });

            console.log(`✅ Successfully loaded ${testSeason} from CSV: ${Object.keys(seasonData[testSeason]).length} teams`);
            console.log('All teams loaded:', Object.keys(seasonData[testSeason]));
            
            // Generate seasons list for loading other seasons
            const seasons = [];
            for (let year = 1993; year <= 2023; year++) {
                const seasonKey = `${year}-${String(year + 1).slice(-2)}`;
                seasons.push(seasonKey);
            }
            
            // If successful, try to load all other seasons using the working path pattern
            if (workingPath) {
                await loadAllSeasons(seasons, workingPath);
            }
            
            // Force update the grid if we're currently viewing 2023-24
            if (currentSeason === testSeason) {
                console.log('Refreshing 2023-24 data display...');
                updateTeamGrid();
            }
        }
        
        isDataLoaded = true;
        updateTeamGrid();
        
    } catch (error) {
        console.error('Error loading CSV data:', error);
        console.log('Using fallback data...');
        
        // Ensure fallback data is available
        if (Object.keys(seasonData).length === 0) {
            const fallbackData = generateFallbackSeasonData();
            Object.assign(seasonData, fallbackData);
        }
        isDataLoaded = true;
        updateTeamGrid();
    }
}

// Function to load all seasons
async function loadAllSeasons(seasons, workingPathPattern) {
    console.log('Loading all seasons using pattern:', workingPathPattern);
    
    for (const season of seasons) {
        if (season === '2023-24') continue; // Already loaded
        
        try {
            // Convert season format properly: handle 90s years correctly
            const yearParts = season.split('-');
            const startYear = yearParts[0];
            const endYearShort = yearParts[1];
            
            // Handle 90s years (94 -> 1994) vs 2000s years (01 -> 2001)
            let endYear;
            if (parseInt(endYearShort) >= 94) {
                endYear = `19${endYearShort}`;  // 94-99 -> 1994-1999
            } else {
                endYear = `20${endYearShort}`;  // 00-93 -> 2000-2093
            }
            
            const fullYear = `${startYear}-${endYear}`;
            const filename = `model/poisson/lambdas/mle-L-BFGS-B-lambdas/${fullYear}-parameters.csv`;
            
            console.log(`Attempting to load: ${season} -> ${filename}`);
            
            const response = await fetch(filename);
            if (!response.ok) {
                console.warn(`Could not load ${filename}: HTTP ${response.status}`);
                continue;
            }
            
            const csvData = await response.text();
            const parsedData = Papa.parse(csvData, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                delimitersToGuess: [',', '\t', '|', ';']
            });

            seasonData[season] = {};
            
            // Process each team in the CSV
            parsedData.data.forEach((row, index) => {
                if (row.Team && row.Team.trim()) {
                    const teamName = row.Team.trim();
                    seasonData[season][teamName] = {
                        attack: Number(row.Attack || 0).toFixed(2),
                        defense: Number(row.Defend || 0).toFixed(2),
                        homeAdvantage: Number(row.HomeAdvantage || 0).toFixed(2),
                        order: index
                    };
                }
            });

            console.log(`✅ Successfully loaded ${season}: ${Object.keys(seasonData[season]).length} teams`);
            
        } catch (error) {
            console.warn(`❌ Failed to load ${season}:`, error.message);
        }
    }
    
    console.log(`📊 Total seasons loaded: ${Object.keys(seasonData).length}`);
}

// Function to load a specific season on demand
async function loadSpecificSeason(season) {
    try {
        // Convert season format: handle 90s years correctly
        const yearParts = season.split('-');
        const startYear = yearParts[0];
        const endYearShort = yearParts[1];
        
        // Handle 90s years (94 -> 1994) vs 2000s years (01 -> 2001)
        let endYear;
        if (parseInt(endYearShort) >= 94) {
            endYear = `19${endYearShort}`;  // 94-99 -> 1994-1999
        } else {
            endYear = `20${endYearShort}`;  // 00-93 -> 2000-2093
        }
        
        const fullYear = `${startYear}-${endYear}`;
        const filename = `model/poisson/lambdas/mle-L-BFGS-B-lambdas/${fullYear}-parameters.csv`;
        
        console.log(`Loading specific season: ${season} -> ${filename}`);
        
        const response = await fetch(filename);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const csvData = await response.text();
        const parsedData = Papa.parse(csvData, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            delimitersToGuess: [',', '\t', '|', ';']
        });

        seasonData[season] = {};
        
        // Process each team in the CSV
        parsedData.data.forEach((row, index) => {
            if (row.Team && row.Team.trim()) {
                const teamName = row.Team.trim();
                seasonData[season][teamName] = {
                    attack: Number(row.Attack || 0).toFixed(2),
                    defense: Number(row.Defend || 0).toFixed(2),
                    homeAdvantage: Number(row.HomeAdvantage || 0).toFixed(2),
                    order: index
                };
            }
        });

        console.log(`✅ Successfully loaded ${season}: ${Object.keys(seasonData[season]).length} teams`);
        updateTeamGrid();
        
    } catch (error) {
        console.error(`❌ Failed to load season ${season}:`, error);
        // Show error message
        const grid = document.getElementById('team-grid');
        grid.innerHTML = `<div style="text-align: center; padding: 40px; color: #666;">
            Failed to load data for ${season} season.<br>
            <small>Error: ${error.message}</small>
        </div>`;
    }
}

// Navigation functions
function slideNav(direction) {
    currentNavIndex += direction;
    if (currentNavIndex < 0) currentNavIndex = 2;
    if (currentNavIndex >= 3) currentNavIndex = 0;
    
    updateNavPosition();
    updateIndicators();
}

function slideToCard(index) {
    currentNavIndex = index;
    updateNavPosition();
    updateIndicators();
}

function updateNavPosition() {
    const navCards = document.getElementById('nav-cards');
    const cardWidth = 300; // 280px + 20px gap
    const offset = -currentNavIndex * cardWidth;
    navCards.style.transform = `translateX(${offset}px)`;
}

function updateIndicators() {
    const indicators = document.querySelectorAll('.nav-indicator');
    indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentNavIndex);
    });
}

function showSection(sectionIndex) {
    // Update navigation cards
    const navCards = document.querySelectorAll('.nav-card');
    navCards.forEach((card, index) => {
        card.classList.toggle('active', index === sectionIndex);
    });

    // Update content sections
    const contentSections = document.querySelectorAll('.content-section');
    contentSections.forEach((section, index) => {
        section.classList.toggle('active', index === sectionIndex);
    });

    currentSection = sectionIndex;
    currentNavIndex = sectionIndex;
    updateNavPosition();
    updateIndicators();

    // Initialize charts if needed
    if (sectionIndex === 1) {
    initRegressionCharts();
    loadRegressionData(); // Load regression data when section is shown
    } else if (sectionIndex === 2) {
        initSimulationCharts();
    }
}

// Team grid functions
function generateTeamCard(teamName, data) {
    return `
        <div class="team-card" style="border-top: 4px solid #667eea">
            <div class="team-header">
                <div class="team-name">
                    <span style="margin-right: 10px;">⚽</span>
                    ${teamName}
                </div>
            </div>
            <div class="lambda-stats">
                <div class="lambda-item lambda-attack">
                    <div class="lambda-value">${data.attack}</div>
                    <div class="lambda-label">λ Attack</div>
                </div>
                <div class="lambda-item lambda-defense">
                    <div class="lambda-value">${data.defense}</div>
                    <div class="lambda-label">λ Defense</div>
                </div>
            </div>
        </div>
    `;
}

function generateHomeAdvantageCard(homeAdvantage, season) {
    return `
        <div class="home-advantage-title">
            🏟️ Home Advantage Factor
        </div>
        <div class="home-advantage-value">${homeAdvantage}</div>
        <div class="home-advantage-desc">
            Season ${season} • Applied to all home teams in Poisson regression model
        </div>
    `;
}

function updateTeamGrid() {
    console.log('updateTeamGrid called, isDataLoaded:', isDataLoaded);
    
    const grid = document.getElementById('team-grid');
    const homeAdvantageCard = document.getElementById('home-advantage-card');
    
    // Show loading if no data at all
    if (Object.keys(seasonData).length === 0) {
        grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">⏳ Loading season data...</div>';
        homeAdvantageCard.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.7);">⏳ Loading...</div>';
        return;
    }

    const data = seasonData[currentSeason];
    
    console.log('Current season:', currentSeason);
    console.log('Available seasons:', Object.keys(seasonData));
    console.log('Data for current season:', data);
    
    if (!data || Object.keys(data).length === 0) {
        // Show loading message for this specific season
        grid.innerHTML = `<div style="text-align: center; padding: 40px; color: #666;">
            ⏳ Loading data for ${currentSeason} season...<br>
            <small>Available seasons: ${Object.keys(seasonData).join(', ')}</small>
        </div>`;
        homeAdvantageCard.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.7);">⏳ Loading...</div>';
        return;
    }
    
    console.log(`Season: ${currentSeason}, Teams count: ${Object.keys(data).length}`);
    
    // Extract home advantage from the first team's data (since it's the same for all teams in a season)
    const firstTeamData = Object.values(data)[0];
    const homeAdvantage = firstTeamData?.homeAdvantage || 'N/A';
    
    // Update home advantage card
    homeAdvantageCard.innerHTML = generateHomeAdvantageCard(homeAdvantage, currentSeason);
    
    // Sort teams alphabetically
    const sortedTeams = Object.entries(data).sort((a, b) => a[0].localeCompare(b[0]));
    
    console.log('Sorted teams:', sortedTeams.map(([name]) => name));
    
    const cardsHtml = sortedTeams.map(([team, teamData]) => 
        generateTeamCard(team, teamData)
    ).join('');
    
    console.log('Generated HTML length:', cardsHtml.length);
    
    grid.innerHTML = cardsHtml;
}

function updateSeason() {
    currentSeason = document.getElementById('season').value;
    console.log('Season changed to:', currentSeason);
    
    // Always update the grid first with existing data (fallback or real)
    updateTeamGrid();
    
    // For 2023-24, try to load real CSV data if not already loaded with real data
    if (currentSeason === '2023-24') {
        // Check if we have real CSV data (more than 10 teams suggests real data vs fallback)
        const currentData = seasonData[currentSeason];
        if (!currentData || Object.keys(currentData).length <= 10) {
            console.log('Attempting to load real 2023-24 CSV data...');
            loadSpecificSeason(currentSeason);
        }
    } else if (!seasonData[currentSeason]) {
        // For other seasons, only load if data doesn't exist
        loadSpecificSeason(currentSeason);
    }
}

// Initialize simulation data with 2023-24 sample - CORRECTED DATA
simulationData['2023-24'] = {
    'Manchester City': { rank: 1, points: '86.4', goalsFor: '95.18', goalsAgainst: '35.7', goalDifference: '59.48' },
    'Arsenal': { rank: 2, points: '84.62', goalsFor: '87.87', goalsAgainst: '33.62', goalDifference: '54.25' },
    'Liverpool': { rank: 3, points: '77.96', goalsFor: '84.78', goalsAgainst: '42.08', goalDifference: '42.7' },
    'Tottenham Hotspur': { rank: 4, points: '62.78', goalsFor: '76.73', goalsAgainst: '60.09', goalDifference: '16.64' },
    'Manchester United': { rank: 5, points: '51.67', goalsFor: '57.33', goalsAgainst: '59.33', goalDifference: '-2.0' },
    'Chelsea': { rank: 6, points: '61.98', goalsFor: '77.72', goalsAgainst: '62.38', goalDifference: '15.34' },
    'Newcastle': { rank: 7, points: '63.89', goalsFor: '80.73', goalsAgainst: '61.92', goalDifference: '18.81' },
    'Aston Villa': { rank: 8, points: '60.89', goalsFor: '74.48', goalsAgainst: '61.16', goalDifference: '13.32' },
    'Crystal Palace': { rank: 9, points: '52.7', goalsFor: '57.62', goalsAgainst: '57.91', goalDifference: '-0.29' },
    'Fulham': { rank: 10, points: '50.77', goalsFor: '56.86', goalsAgainst: '60.35', goalDifference: '-3.49' },
    'Brighton': { rank: 11, points: '49.02', goalsFor: '54.15', goalsAgainst: '60.36', goalDifference: '-6.21' },
    'Everton': { rank: 12, points: '47.75', goalsFor: '42.69', goalsAgainst: '49.54', goalDifference: '-6.86' },
    'West Ham': { rank: 13, points: '47.32', goalsFor: '61.68', goalsAgainst: '71.81', goalDifference: '-10.13' },
    'Wolves': { rank: 14, points: '46.48', goalsFor: '53.6', goalsAgainst: '64.18', goalDifference: '-10.58' },
    'Brentford': { rank: 15, points: '46.2', goalsFor: '54.18', goalsAgainst: '65.34', goalDifference: '-11.17' },
    'Bournemouth': { rank: 16, points: '44.55', goalsFor: '52.45', goalsAgainst: '66.32', goalDifference: '-13.87' },
    'Nottm Forest': { rank: 17, points: '40.05', goalsFor: '47.14', goalsAgainst: '68.31', goalDifference: '-21.18' },
    'Luton': { rank: 18, points: '36.16', goalsFor: '54.35', goalsAgainst: '85.42', goalDifference: '-31.07' },
    'Burnley': { rank: 19, points: '33.0', goalsFor: '41.71', goalsAgainst: '75.52', goalDifference: '-33.81' },
    'Sheffield United': { rank: 20, points: '18.17', goalsFor: '34.77', goalsAgainst: '104.66', goalDifference: '-69.89' }
};

// Function to convert season format for simulation files
function convertSeasonToFilename(season) {
    // Convert "2023-24" to "table-2023-2024.csv"
    const parts = season.split('-');
    const startYear = parts[0];
    const endYearShort = parts[1];
    
    // Handle year conversion (24 -> 2024, etc.)
    let endYear;
    if (parseInt(endYearShort) < 50) {
        endYear = `20${endYearShort}`;
    } else {
        endYear = `19${endYearShort}`;
    }
    
    return `table-${startYear}-${endYear}.csv`;
}

// Function to load simulation data for a specific season
async function loadSimulationData(season) {
    try {
        const filename = convertSeasonToFilename(season);
        const filepath = `sim/results/tables/${filename}`;
        
        console.log(`Loading simulation data: ${season} -> ${filepath}`);
        
        const response = await fetch(filepath);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const csvData = await response.text();
        const parsedData = Papa.parse(csvData, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            delimitersToGuess: [',', '\t', '|', ';']
        });

        simulationData[season] = {};
        
        // Process each team in the CSV
        parsedData.data.forEach((row, index) => {
            if (row.Team && row.Team.trim()) {
                const teamName = row.Team.trim();
                simulationData[season][teamName] = {
                    rank: row.rank || index + 1,
                    points: Number(row.Pts || 0).toFixed(1),
                    goalsFor: Number(row.GF || 0).toFixed(1),
                    goalsAgainst: Number(row.GA || 0).toFixed(1),
                    goalDifference: Number(row.GD || 0).toFixed(1)
                };
            }
        });

        console.log(`✅ Successfully loaded simulation data for ${season}: ${Object.keys(simulationData[season]).length} teams`);
        updateSimulationGrid();
        
    } catch (error) {
        console.error(`❌ Failed to load simulation data for ${season}:`, error);
        // Show error message
        const grid = document.getElementById('simulation-grid');
        if (grid) {
            grid.innerHTML = `<div style="text-align: center; padding: 40px; color: #666;">
                Failed to load simulation data for ${season} season.<br>
                <small>Error: ${error.message}</small>
            </div>`;
        }
    }
}

// Function to normalize team names for Big 6 comparison
function normalizeTeamName(teamName) {
    const teamMappings = {
        'Tottenham': 'Tottenham Hotspur',
        'Tottenham Hotspur': 'Tottenham Hotspur',
        'Man City': 'Manchester City',
        'Manchester City': 'Manchester City',
        'Man United': 'Manchester United',
        'Manchester United': 'Manchester United',
        'Arsenal': 'Arsenal',
        'Chelsea': 'Chelsea',
        'Liverpool': 'Liverpool'
    };
    return teamMappings[teamName] || teamName;
}
function generateBig6ComparisonCard(teamName, predictedRank, actualRank) {
    const difference = Math.abs(predictedRank - actualRank);
    let accuracyClass = 'accuracy-perfect';
    let accuracyText = '✓ Perfect';
    
    if (difference === 0) {
        accuracyClass = 'accuracy-perfect';
        accuracyText = '✓ Perfect';
    } else if (difference <= 2) {
        accuracyClass = 'accuracy-good';
        accuracyText = `±${difference} positions`;
    } else {
        accuracyClass = 'accuracy-poor';
        accuracyText = `±${difference} positions`;
    }
    
    return `
        <div class="big6-team-card">
            <div class="big6-team-name">${teamName}</div>
            <div class="big6-ranking-comparison">
                <div class="big6-rank-item">
                    <div class="big6-rank-type">Predicted</div>
                    <div class="big6-rank-value">${predictedRank}</div>
                </div>
                <div class="big6-vs-divider">vs</div>
                <div class="big6-rank-item">
                    <div class="big6-rank-type">Actual</div>
                    <div class="big6-rank-value">${actualRank}</div>
                </div>
            </div>
            <div class="big6-accuracy">
                <div class="big6-accuracy-label">Accuracy</div>
                <div class="big6-accuracy-value ${accuracyClass}">${accuracyText}</div>
            </div>
        </div>
    `;
}

// Function to update Big 6 comparison
function updateBig6Comparison() {
    const comparisonGrid = document.getElementById('big6-comparison');
    
    if (!comparisonGrid) return;
    
    // Static Big 6 data from the provided image, sorted by predicted rank (high to low)
    const staticBig6Data = [
        { name: 'Manchester City', predictedRank: 1, actualRank: 3 },
        { name: 'Arsenal', predictedRank: 2, actualRank: 2 },
        { name: 'Liverpool', predictedRank: 3, actualRank: 1 },
        { name: 'Tottenham Hotspur', predictedRank: 4, actualRank: 6 },
        { name: 'Manchester United', predictedRank: 5, actualRank: 5 },
        { name: 'Chelsea', predictedRank: 6, actualRank: 4 }
    ];
    
    // Generate cards for each team
    const big6Cards = staticBig6Data.map(team => 
        generateBig6ComparisonCard(team.name, team.predictedRank, team.actualRank)
    );
    
    comparisonGrid.innerHTML = big6Cards.join('');
}

function generateSimulationCard(teamName, data) {
    const rankColor = data.rank <= 4 ? '#28a745' : data.rank <= 6 ? '#17a2b8' : data.rank <= 10 ? '#ffc107' : data.rank <= 17 ? '#fd7e14' : '#dc3545';
    
    return `
        <div class="simulation-card" style="border-top: 4px solid ${rankColor}">
            <div class="sim-team-header">
                <div class="sim-team-name">
                    <span style="margin-right: 10px;">⚽</span>
                    ${teamName}
                </div>
                <div class="sim-team-rank" style="background: ${rankColor}">
                    #${data.rank}
                </div>
            </div>
            <div class="sim-stats-grid">
                <div class="sim-stat-item sim-points">
                    <div class="sim-stat-value">${data.points}</div>
                    <div class="sim-stat-label">Points</div>
                </div>
                <div class="sim-stat-item sim-gd">
                    <div class="sim-stat-value">${data.goalDifference > 0 ? '+' : ''}${data.goalDifference}</div>
                    <div class="sim-stat-label">Goal Diff</div>
                </div>
            </div>
            <div class="sim-goals-row">
                <div class="sim-goals-item sim-gf">
                    <div class="sim-goals-value">${data.goalsFor}</div>
                    <div class="sim-goals-label">Goals For</div>
                </div>
                <div class="sim-goals-item sim-ga">
                    <div class="sim-goals-value">${data.goalsAgainst}</div>
                    <div class="sim-goals-label">Goals Against</div>
                </div>
            </div>
        </div>
    `;
}

// Function to update simulation grid
function updateSimulationGrid() {
    console.log('updateSimulationGrid called for season:', currentSimulationSeason);
    
    const grid = document.getElementById('simulation-grid');
    
    if (!grid) return;
    
    const data = simulationData[currentSimulationSeason];
    
    if (!data || Object.keys(data).length === 0) {
        grid.innerHTML = `<div style="text-align: center; padding: 40px; color: #666;">
            ⏳ Loading simulation data for ${currentSimulationSeason} season...
        </div>`;
        return;
    }
    
    console.log(`Season: ${currentSimulationSeason}, Teams count: ${Object.keys(data).length}`);
    
    // Sort teams by points (descending) instead of rank
    const sortedTeams = Object.entries(data).sort((a, b) => {
        return parseFloat(b[1].points) - parseFloat(a[1].points);
    });
    
    // Get actual rankings for this season
    const seasonActualRankings = actualRankings[currentSimulationSeason] || {};
    
    const cardsHtml = sortedTeams.map(([team, teamData]) => {
        // Normalize team name for actual ranking lookup
        let actualRank = null;
        
        // Try to find actual rank with different possible team name variations
        const possibleNames = [
            team,
            team.replace('Manchester ', 'Man '),
            team.replace('Man ', 'Manchester '),
            team.replace('Nottm Forest', 'Nottingham Forest'),
            team.replace('Sheffield United', 'Sheffield Utd'),
            team === 'Tottenham' ? 'Tottenham Hotspur' : team,
            team === 'Tottenham Hotspur' ? 'Tottenham' : team
        ];
        
        for (const possibleName of possibleNames) {
            if (seasonActualRankings[possibleName]) {
                actualRank = seasonActualRankings[possibleName];
                break;
            }
        }
        
        return generateSimulationCard(team, teamData, actualRank);
    }).join('');
    
    grid.innerHTML = cardsHtml;
    
    // Also update Big 6 comparison
    updateBig6Comparison();
}

// Function to handle simulation season change
function updateSimulationSeason() {
    currentSimulationSeason = document.getElementById('simulationSeason').value;
    console.log('Simulation season changed to:', currentSimulationSeason);
    
    // Update Big 6 comparison immediately with available data
    updateBig6Comparison();
    
    // Check if data exists for this season
    if (simulationData[currentSimulationSeason]) {
        updateSimulationGrid();
    } else {
        // Try to load this specific season
        loadSimulationData(currentSimulationSeason);
    }
}

function initSimulationCharts() {
    // Ranking Comparison Chart
    const rankingCtx = document.getElementById('rankingComparisonChart');
    if (rankingCtx && !rankingCtx.chart) {
        rankingCtx.chart = new Chart(rankingCtx, {
            type: 'line',
            data: {
                labels: ['2020-21', '2021-22', '2022-23', '2023-24'],
                datasets: [{
                    label: 'Predicted',
                    data: [1, 2, 1, 1],
                    borderColor: '#667eea',
                    backgroundColor: 'transparent'
                }, {
                    label: 'Actual',
                    data: [1, 1, 1, 1],
                    borderColor: '#764ba2',
                    backgroundColor: 'transparent'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Manchester City Ranking Prediction'
                    }
                }
            }
        });
    }

    // Points Accuracy Chart
    const pointsCtx = document.getElementById('pointsAccuracyChart');
    if (pointsCtx && !pointsCtx.chart) {
        pointsCtx.chart = new Chart(pointsCtx, {
            type: 'bar',
            data: {
                labels: ['Man City', 'Arsenal', 'Liverpool', 'Chelsea', 'Man Utd', 'Tottenham'],
                datasets: [{
                    label: 'Prediction Accuracy (%)',
                    data: [92, 88, 85, 78, 82, 80],
                    backgroundColor: '#667eea'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Points Prediction Accuracy'
                    }
                }
            }
        });
    }
}

// Function to load regression model data
async function loadRegressionData() {
    try {
        console.log('Loading regression model data...');
        
        // Load model parameters
        const parametersResponse = await fetch('./model/regression/results/linear_regression/mle-L-BFGS-B-lambdas/model_parameters_new_no_home_advantage.json');
        if (parametersResponse.ok) {
            regressionParameters = await parametersResponse.json();
            console.log('✅ Successfully loaded model parameters:', regressionParameters);
            updateRegressionParameters();
        } else {
            console.warn('⚠️ Could not load model parameters, using defaults');
        }
        
        // Load predictions
        const predictionsResponse = await fetch('./model/regression/results/linear_regression/mle-L-BFGS-B-lambdas/predictions_2024_2025_no_home_advantage.json');
        if (predictionsResponse.ok) {
            big6Predictions = await predictionsResponse.json();
            console.log('✅ Successfully loaded Big 6 predictions:', big6Predictions);
            updatePredictionsMatrix();
        } else {
            console.warn('⚠️ Could not load predictions data');
            showPredictionsError();
        }
        
    } catch (error) {
        console.error('❌ Error loading regression data:', error);
        showPredictionsError();
    }
}

// Function to update regression parameters in the UI
function updateRegressionParameters() {
    if (Object.keys(regressionParameters).length === 0) return;
    
    const interceptEl = document.getElementById('param-intercept');
    const beta1El = document.getElementById('param-beta1');
    const beta2El = document.getElementById('param-beta2');
    const beta3El = document.getElementById('param-beta3');
    
    if (interceptEl) interceptEl.textContent = regressionParameters.intercept?.toFixed(4) || '0.5071';
    if (beta1El) beta1El.textContent = regressionParameters.beta1?.toFixed(4) || '0.0238';
    if (beta2El) beta2El.textContent = regressionParameters.beta2?.toFixed(4) || '0.2632';
    if (beta3El) beta3El.textContent = regressionParameters.beta3?.toFixed(4) || '0.3611';
}

// Function to generate predictions matrix HTML
function generatePredictionsMatrix() {
    if (Object.keys(big6Predictions).length === 0) {
        return '<div class="matrix-loading">⏳ Loading predictions...</div>';
    }
    
    const teams = Object.keys(big6Predictions).sort();
    
    let html = '<table class="matrix-table">';
    
    // Header row
    html += '<thead><tr><th>Home \\ Away</th>';
    teams.forEach(team => {
        const shortName = team.replace('Man ', '').replace('Tottenham', 'Spurs');
        html += `<th>${shortName}</th>`;
    });
    html += '</tr></thead>';
    
    // Data rows
    html += '<tbody>';
    teams.forEach(homeTeam => {
        html += `<tr><td>${homeTeam.replace('Man ', '')}</td>`;
        teams.forEach(awayTeam => {
            if (homeTeam === awayTeam) {
                html += '<td style="background: #f8f9fa; color: #6c757d;">—</td>';
            } else {
                const prediction = big6Predictions[homeTeam][awayTeam];
                const value = Number(prediction).toFixed(3);
                const colorClass = prediction > 1.5 ? 'prediction-positive' : prediction < 1.0 ? 'prediction-negative' : '';
                html += `<td><span class="prediction-value ${colorClass}">${value}</span></td>`;
            }
        });
        html += '</tr>';
    });
    html += '</tbody></table>';
    
    return html;
}

// Function to update predictions matrix
function updatePredictionsMatrix() {
    const matrixContainer = document.getElementById('predictions-matrix');
    if (matrixContainer) {
        matrixContainer.innerHTML = '<div class="matrix-loading">⏳ Loading predictions...</div>';
    }

    // Load regression data
    loadRegressionData();
}

function initRegressionCharts() {
    console.log('Regression charts initialized');
    // This function can be expanded later to add actual charts
    // For now, it prevents the ReferenceError
}

// Function to show predictions error
function showPredictionsError() {
    const matrixContainer = document.getElementById('predictions-matrix');
    if (matrixContainer) {
        matrixContainer.innerHTML = `
            <div class="matrix-error">
                ❌ Could not load predictions data<br>
                <small>Expected path: ./model/regression/results/linear_regression/mle-L-BFGS-B-lambdas/predictions_2024_2025_no_home_advantage.json</small>
            </div>
        `;
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing...');
    
    // Initialize with empty data first
    isDataLoaded = false;
    updateTeamGrid(); // Show loading message
    
    // Initialize simulation grid with sample data
    updateSimulationGrid();
    
    // Initialize Big 6 comparison
    updateBig6Comparison();
    
    // Try to load real CSV data, with fallback
    loadSeasonData();
    
    // Try to load additional simulation data
    loadSimulationData(currentSimulationSeason);
});
</script>
</body>
</html>